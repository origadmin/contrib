syntax = "proto3";

package contrib.api.security.authz.v1;

import "security/authz/v1/authz.proto";

option go_package = "github.com/origadmin/contrib/api/gen/go/security/authz/v1;authzv1";

// AuthorizerService provides endpoints for performing authorization checks.
service AuthorizerService {
  // Authorized performs a single authorization check.
  rpc Authorized(AuthorizedRequest) returns (AuthorizedResponse);

  // FilterAuthorized performs a batch authorization check on a list of rule specs.
  rpc FilterAuthorized(FilterAuthorizedRequest) returns (FilterAuthorizedResponse);

  // FilterAuthorizedResources filters a list of resources against a rule template.
  rpc FilterAuthorizedResources(FilterAuthorizedResourcesRequest) returns (FilterAuthorizedResourcesResponse);

  // FilterAuthorizedActions filters a list of actions against a rule template.
  rpc FilterAuthorizedActions(FilterAuthorizedActionsRequest) returns (FilterAuthorizedActionsResponse);

  // FilterAuthorizedDomains filters a list of domains against a rule template.
  rpc FilterAuthorizedDomains(FilterAuthorizedDomainsRequest) returns (FilterAuthorizedDomainsResponse);
}

// --- Messages for Authorized ---
message AuthorizedRequest {
  RuleSpec spec = 1;
}
message AuthorizedResponse {
  bool allowed = 1;
}

// --- Messages for FilterAuthorized ---
message FilterAuthorizedRequest {
  repeated RuleSpec specs = 1;
}
message FilterAuthorizedResponse {
  repeated RuleSpec specs = 1;
}

// --- Messages for FilterAuthorizedResources ---
message FilterAuthorizedResourcesRequest {
  // A template for the authorization check. The 'resource' field will be ignored.
  RuleSpec spec_template = 1;
  // The list of resources to check.
  repeated string resources = 2;
}
message FilterAuthorizedResourcesResponse {
  // A list containing only the resources that the principal is authorized to access.
  repeated string resources = 1;
}

// --- Messages for FilterAuthorizedActions ---
message FilterAuthorizedActionsRequest {
  // A template for the authorization check. The 'action' field will be ignored.
  RuleSpec spec_template = 1;
  // The list of actions to check.
  repeated string actions = 2;
}
message FilterAuthorizedActionsResponse {
  // A list containing only the actions that the principal is authorized to perform.
  repeated string actions = 1;
}

// --- Messages for FilterAuthorizedDomains ---
message FilterAuthorizedDomainsRequest {
  // A template for the authorization check. The 'domain' field will be ignored.
  RuleSpec spec_template = 1;
  // The list of domains to check.
  repeated string domains = 2;
}
message FilterAuthorizedDomainsResponse {
  // A list containing only the domains that the principal is authorized to access.
  repeated string domains = 1;
}
